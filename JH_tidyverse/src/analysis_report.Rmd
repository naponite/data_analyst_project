---
title: "Johns Hopkins Tidyverse Project"
author: "Napon Meenmanee"
date: "2024-03-15"
output: html_document
---

#### **Introduction:** This is an analysis report for project of Introduction to Tidyverse course by Johns Hopkins

## 1. Libraries use
```{r, warning=FALSE, echo=FALSE}
library(tidyverse)
library(ggplot2)
library(here)
library(janitor)
library(patchwork)
library(knitr)
library(kableExtra)
```


## 2. Import data
#### 2.1 Unzip and setdata file path

```{r echo=FALSE, warning=FALSE}
# set data file path
file <- here("data", "healthcare_datasets.zip")

#display all files in healthcare_datasets.zip
unzip(file, list = TRUE)

```


#### 2.2 read csv files
```{r echo=FALSE, warning=FALSE}
# set data path in zip file
file1 = here("data", unzip(file, list = TRUE)[1,1])
file2 = here("data", unzip(file, list = TRUE)[2,1])

# read file healthcare-coverage
healthcare_coverage <- read_csv(file1, skip = 2, na = c("", "N/A"))
head(healthcare_coverage)

# read file healthcare-spending
healthcare_spending <- read_csv(file2, skip = 2, na = c("", "N/A"))
head(healthcare_spending)
```


## 3. Data preparation

#### 3.1 Clean missing data
- Healthcare coverage table

```{r echo=FALSE, warning=FALSE}
## healthcare_coverage
healthcare_coverage %>%
  remove_missing() -> coverage_clean

head(coverage_clean) %>% 
  kable() %>% 
  kable_styling() %>%
  scroll_box(width = "100%", height = "200px")
```


- Healthcare spending table

```{r echo=FALSE, warning=FALSE}
## healthcare_spending
healthcare_spending %>%
  remove_missing() -> spending_clean

head(spending_clean) %>% 
  kable() %>%
  kable_styling() %>%
  scroll_box(width = "100%", height = "200px")

```


## 4.Data transformation
```{r echo=FALSE, warning=FALSE}
# join data
coverage_clean %>%
  left_join(spending_clean, by = "Location") %>%

  # filter "United States"
  filter(Location == "United States") %>%

  # convert wide to long format table
  pivot_longer(cols = -Location,
               names_to = c("year", ".value"),
               names_sep = "__",
               values_to = "coverage_spend") %>% 
  
  # arrange year
  arrange(year) %>%
  
  # clean column names
  clean_names() %>%

  # rename column
  rename(total_coverage = total) -> data_prep

data_prep %>% 
  kable()

```


## 5.Data exploration

```{r echo=FALSE, warning=FALSE}
# join data
coverage_clean %>%
  left_join(spending_clean, by = "Location") %>%

  # filter "United States"
  filter(Location == "United States") %>%

  # convert wide to long format table
  pivot_longer(cols = -Location,
               names_to = c("year", ".value"),
               names_sep = "__",
               values_to = "coverage_spend") %>% 
  
  # arrange year
  arrange(year) %>%
  
  # clean column names
  clean_names() %>%

  # rename column
  rename(total_coverage = total) -> data_prep

data_prep %>% 
  kable()

```

>
> - Healthcare coverage and Healthcare spending data are trend to increase by the time.
> - The relation between Healthcare coverage and Healthcare spending is positive direction base on year 2013-2014 (base on data available)

```{r echo=FALSE, warning=FALSE, fig.width=10, fig.height=4}
# data exploration
data_prep %>% 
  ggplot(aes(x = year, y = total_coverage)) +
  geom_col(fill = "blue")+
  theme_minimal() -> p1

data_prep %>% 
  ggplot(aes(x = year, y = total_health_spending)) +
  geom_col(fill = "blue")+
  theme_minimal() -> p2

data_prep %>% 
  ggplot(aes(x = total_coverage, y = total_health_spending)) +
  geom_point() +
  geom_smooth(method = "lm", col = "red")+
  theme_minimal() -> p3

p1
p2
p3

```



















